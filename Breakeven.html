<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Revenue Breakeven Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; }
    .container { max-width: 600px; margin: 0 auto; padding: 20px; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; }
    input { width: 100%; padding: 8px; }
    .results { margin-top: 20px; }
    .explanation { margin-top: 20px; display: none; }
    .hidden { display: none; }
    .button-group { margin-top: 20px; }
    img { max-width: 100px; margin-bottom: 20px; vertical-align: middle; }
    h1 { display: inline-block; margin-left: 10px; vertical-align: middle; }
    .top-buttons { display: flex; justify-content: center; margin-bottom: 20px; }
    .top-buttons button { padding: 10px 20px; cursor: pointer; margin: 0 5px; }
    .active { background-color: #007bff; color: white; }
  </style>
</head>
<body>
  <div class="container">
    <div>
      <img src="FlixLogo.png" alt="Flix Logo">
      <h1>Bus Trip Breakeven Calculator</h1>
    </div>
    <div class="top-buttons">
      <button id="usaButton" class="active" onclick="setCountry('USA')">USA</button>
      <button id="canadaButton" onclick="setCountry('Canada')">Canada</button>
    </div>
    <div class="form-group">
      <label for="mg">Minimum Guarantee (<span id="currency">$/mile</span>):</label>
      <input type="number" id="mg" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="totalMiles">Total <span id="distanceLabel">Miles</span> per Trip:</label>
      <input type="number" id="totalMiles" required>
    </div>
    <div class="form-group">
      <label for="productionCost">Production Cost (<span id="currency2">$/mile</span>):</label>
      <input type="number" id="productionCost" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="ticketPrice">Average Ticket Price (<span id="currency3">USD</span>):</label>
      <input type="number" id="ticketPrice" step="0.01" required>
    </div>
    <div class="form-group">
      <label for="totalPassengers">Total Passengers the Bus Can Carry:</label>
      <input type="number" id="totalPassengers" required>
    </div>
    <button onclick="calculate()">Calculate</button>
    <button id="clearButton" class="hidden" onclick="clearResults()">Clear</button>
    <div class="results" id="results"></div>
    <div class="button-group">
      <button id="explanationButton" onclick="showExplanation()">Calculation Explanation</button>
      <button id="closeExplanationButton" class="hidden" onclick="hideExplanation()">Close Explanation</button>
    </div>
    <div class="explanation" id="explanation">
      <h2>Calculation Explanation</h2>
      <p>The program performs several calculations to determine how many passengers are needed to cover costs and guarantees, as well as the load factor, which is the percentage of the bus capacity used.</p>
      <p><strong>A. Cost Per Trip</strong><br>
      First, the program calculates the total cost to operate the trip:<br>
      Cost Per Trip = Total Miles per Trip × Production Cost</p>
      <p><strong>B. Guarantee Per Trip</strong><br>
      Next, it calculates the total guarantee amount for the trip:<br>
      Guarantee Per Trip = Total Miles per Trip × Minimum Guarantee</p>
      <p><strong>C. Required Passengers to Cover Costs</strong><br>
      To find out how many passengers are needed to cover the production cost, the program uses:<br>
      Required Passengers (Cost) = Cost Per Trip / Ticket Price</p>
      <p><strong>D. Load Factor to Cover Costs</strong><br>
      The load factor is then calculated to show the percentage of the bus's capacity that needs to be filled:<br>
      Load Factor (Cost) = (Required Passengers (Cost) / Total Passengers) × 100</p>
      <p><strong>E. Required Passengers to Cover Guarantee</strong><br>
      Similarly, to find out how many passengers are needed to cover the guarantee amount, the program uses:<br>
      Required Passengers (Guarantee) = Guarantee Per Trip / Ticket Price</p>
      <p><strong>F. Load Factor to Cover Guarantee</strong><br>
      The load factor for the guarantee is calculated as:<br>
      Load Factor (Guarantee) = (Required Passengers (Guarantee) / Total Passengers) × 100</p>
    </div>
  </div>
  <script>
    let country = 'USA';

    function setCountry(selectedCountry) {
      country = selectedCountry;
      document.getElementById('usaButton').classList.toggle('active', country === 'USA');
      document.getElementById('canadaButton').classList.toggle('active', country === 'Canada');
      document.getElementById('currency').innerText = country === 'USA' ? '$/mile' : '$/km';
      document.getElementById('currency2').innerText = country === 'USA' ? '$/mile' : '$/km';
      document.getElementById('currency3').innerText = country === 'USA' ? 'USD' : 'CAD';
      document.getElementById('distanceLabel').innerText = country === 'USA' ? 'Miles' : 'Kilometers';
      clearResults();
    }

    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function calculate() {
      const mg = parseFloat(document.getElementById('mg').value);
      const totalMiles = parseFloat(document.getElementById('totalMiles').value);
      const productionCost = parseFloat(document.getElementById('productionCost').value);
      const ticketPrice = parseFloat(document.getElementById('ticketPrice').value);
      const totalPassengers = parseInt(document.getElementById('totalPassengers').value);

      if (isNaN(mg) || isNaN(totalMiles) || isNaN(productionCost) || isNaN(ticketPrice) || isNaN(totalPassengers)) {
        document.getElementById('results').innerHTML = '<p style="color:red;">Error: Missing inputs. Please fill out all fields.</p>';
        return;
      }

      const costPerTrip = totalMiles * productionCost;
      const guaranteePerTrip = totalMiles * mg;

      const requiredPassengersCost = costPerTrip / ticketPrice;
      const loadFactorCost = (requiredPassengersCost / totalPassengers) * 100;

      const requiredPassengersGuarantee = guaranteePerTrip / ticketPrice;
      const loadFactorGuarantee = (requiredPassengersGuarantee / totalPassengers) * 100;

      // New calculations
      const thresholdRevenuePerMile = mg / 0.7;
      const totalMinimumGuarantee = mg * totalMiles;
      const totalRevenueBeforeSplit = (thresholdRevenuePerMile - mg) * totalMiles;
      const passengersToBreakeven = (thresholdRevenuePerMile * totalMiles) / ticketPrice;
      const loadFactorBreakeven = (passengersToBreakeven / totalPassengers) * 100;
      const totalBreakevenRevenue = totalMinimumGuarantee + totalRevenueBeforeSplit;

      const currencySymbol = country === 'USA' ? '$' : '$';
      const distanceUnit = country === 'USA' ? 'mile' : 'km';

      document.getElementById('results').innerHTML = `
        <h2>Results (${country})</h2>
        <p><strong>To Exceed Production Cost of ${currencySymbol}${productionCost.toFixed(2)} per ${distanceUnit}</strong></p>
        <p>Required Number of Passengers: ${requiredPassengersCost ? requiredPassengersCost.toFixed(2) : ''}</p>
        <p>Load Factor: ${loadFactorCost ? loadFactorCost.toFixed(2) : ''}%</p>
        <p><strong>To Exceed Minimum Guarantee of ${currencySymbol}${mg.toFixed(2)} per ${distanceUnit}</strong></p>
        <p>Required Number of Passengers: ${requiredPassengersGuarantee ? requiredPassengersGuarantee.toFixed(2) : ''}</p>
        <p>Load Factor: ${loadFactorGuarantee ? loadFactorGuarantee.toFixed(2) : ''}%</p>
        <p><strong>To exceed the Breakeven Point of ${currencySymbol}${thresholdRevenuePerMile.toFixed(2)} per ${distanceUnit} (RPM)</strong></p>
        <p>Required Number of Passengers: ${passengersToBreakeven.toFixed(2)}</p>
        <p>Load Factor: ${loadFactorBreakeven.toFixed(2)}%</p>
        <h2>Totals</h2>
        <p>Total Minimum Guarantee: ${currencySymbol}${formatNumber(totalMinimumGuarantee.toFixed(2))}</p>
        <p>Revenue Between MG and Split: ${currencySymbol}${formatNumber(totalRevenueBeforeSplit.toFixed(2))}</p>
        <p>Total Breakeven Revenue: ${currencySymbol}${formatNumber(totalBreakevenRevenue.toFixed(2))}</p>
      `;

      document.getElementById('clearButton').classList.remove('hidden');
    }

    function clearResults() {
      document.getElementById('results').innerHTML = '';
      document.getElementById('mg').value = '';
      document.getElementById('totalMiles').value = '';
      document.getElementById('productionCost').value = '';
      document.getElementById('ticketPrice').value = '';
      document.getElementById('totalPassengers').value = '';
      document.getElementById('clearButton').classList.add('hidden');
    }

    function showExplanation() {
      document.getElementById('explanation').style.display = 'block';
      document.getElementById('explanationButton').classList.add('hidden');
      document.getElementById('closeExplanationButton').classList.remove('hidden');
    }

    function hideExplanation() {
      document.getElementById('explanation').style.display = 'none';
      document.getElementById('explanationButton').classList.remove('hidden');
      document.getElementById('closeExplanationButton').classList.add('hidden');
    }

    // Set default country to USA
    setCountry('USA');
  </script>
</body>
</html>
